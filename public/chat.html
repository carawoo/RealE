<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>RealE - 부동산 AI 상담</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>

  <style>
    * { margin:0; padding:0; box-sizing:border-box; }

    body {
      font-family:-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background:#0f0f23; height:100vh; overflow:hidden; color:#e5e7eb;
    }

    .chat-container { height:100vh; display:flex; flex-direction:column; background:#0f0f23; position:relative; }
    .chat-messages { flex:1; overflow-y:auto; background:#0f0f23; padding:40px 20px 80px; }

    .welcome-section {
      display:flex; flex-direction:column; align-items:center;
      padding:80px 20px 40px; text-align:center; max-width:600px; margin:0 auto;
    }
    .bot-avatar {
      width:64px; height:64px; background:linear-gradient(135deg, #8b5cf6, #06b6d4);
      border-radius:50%; display:flex; align-items:center; justify-content:center;
      font-size:24px; color:#fff; margin-bottom:20px; box-shadow:0 4px 20px rgba(139,92,246,.3);
    }
    .welcome-text h2 { font-size:24px; font-weight:600; color:#f9fafb; margin-bottom:8px; }
    .welcome-text p { font-size:16px; color:#d1d5db; line-height:1.5; margin-bottom:24px; }

    .quick-options { display:grid; grid-template-columns:1fr; gap:12px; width:100%; max-width:400px; }
    .quick-option{
      background:linear-gradient(135deg,#1e1b4b,#312e81); border:1px solid #4338ca;
      padding:16px 20px; border-radius:12px; font-size:15px; color:#e0e7ff; cursor:pointer;
      transition:all .3s ease; text-align:left; display:flex; align-items:center; gap:12px;
      position:relative; overflow:hidden;
    }
    .quick-option::before{
      content:''; position:absolute; top:0; left:-100%; width:100%; height:100%;
      background:linear-gradient(90deg,transparent,rgba(139,92,246,.1),transparent); transition:left .6s;
    }
    .quick-option:hover{ background:linear-gradient(135deg,#2d1b69,#3730a3); border-color:#6366f1; transform:translateY(-2px); box-shadow:0 8px 25px rgba(139,92,246,.25); }
    .quick-option:hover::before{ left:100%; }
    .quick-option .icon{ font-size:18px; color:#8b5cf6; }

    .messages-container { max-width:768px; margin:0 auto; padding:40px 0 0; }

    .message{ margin-bottom:24px; display:flex; align-items:flex-start; gap:0; } /* gap 0으로 아바타 제거시 여백 제거 */
    .message-avatar{ display:none !important; } /* 아바타 숨김 */

    .message-content{ flex:1; font-size:15px; line-height:1.6; color:#f9fafb; }
    .message.user .message-content{
      background:transparent; padding:12px 0; border-radius:0; max-width:80%;
      margin-left:auto; color:#f9fafb; text-align:right;
    }
    .message.assistant .message-content{
      background:#1f2937; padding:16px; border-radius:12px; max-width:80%; border:1px solid #374151;
    }
    .message-time{ font-size:12px; color:#9ca3af; margin-top:4px; }

    .chat-input-container{
      position:fixed; bottom:0; left:0; right:0; background:#1f2937; padding:16px 20px;
      border-top:1px solid #374151; z-index:100;
    }
    .chat-input{
      display:flex; align-items:stretch; gap:12px; max-width:768px; margin:0 auto; /* stretch로 동일 높이 */
    }
    .input-wrapper{
      flex:1; position:relative; background:#374151; border:1px solid #4b5563; border-radius:12px;
      transition:all .2s ease; display:flex; align-items:center; /* textarea 높이에 맞춰 래퍼도 늘림 */
    }
    .input-wrapper:focus-within{ border-color:#8b5cf6; box-shadow:0 0 0 3px rgba(139,92,246,.2); }
    .chat-input textarea{
      width:100%; min-height:44px; max-height:120px; padding:12px 50px 12px 16px; border:none; border-radius:12px;
      resize:none; font-family:inherit; font-size:16px; line-height:1.5; outline:none; background:transparent; color:#f9fafb;
    }
    .chat-input textarea::placeholder{ color:#9ca3af; }

    .emoji-button{
      position:absolute; right:12px; top:50%; transform:translateY(-50%);
      background:none; border:none; font-size:18px; cursor:pointer; color:#9ca3af; padding:4px; border-radius:4px; transition:background .2s ease;
    }
    .emoji-button:hover{ background:#f3f4f6; }

    .send-button{
      width:44px; height:auto; background:linear-gradient(135deg,#8b5cf6,#06b6d4);
      border:none; border-radius:12px; color:#fff; font-size:16px; cursor:pointer; transition:all .3s ease;
      display:flex; align-items:center; justify-content:center; align-self:stretch; flex-shrink:0;
      box-shadow:0 4px 15px rgba(139,92,246,.3);
    }
    .send-button:hover:not(:disabled){ transform:translateY(-2px); box-shadow:0 8px 25px rgba(139,92,246,.4); }
    .send-button:disabled{ background:#4b5563; cursor:not-allowed; transform:none; box-shadow:none; }
    .send-button i{ display:inline-flex; align-items:center; justify-content:center; line-height:1; vertical-align:middle; height:1em; width:1em; transform:translateY(1px); }

    .typing-indicator{ display:none; padding:0 16px 16px; }
    .typing-container{ max-width:768px; margin:0 auto; display:flex; align-items:flex-start; gap:0; } /* gap 0 */
    .typing-avatar{ display:none !important; } /* 타이핑 아바타도 숨김 */
    .typing-bubble{ background:#1f2937; border:1px solid #374151; padding:12px 16px; border-radius:12px; display:flex; align-items:center; gap:4px; }
    .typing-dots{ display:flex; gap:4px; }
    .typing-dots span{ width:6px; height:6px; background:#8b5cf6; border-radius:50%; animation:typing 1.4s infinite; }
    .typing-dots span:nth-child(2){ animation-delay:.2s; }
    .typing-dots span:nth-child(3){ animation-delay:.4s; }
    @keyframes typing{ 0%,60%,100%{ transform:translateY(0); opacity:.4; } 30%{ transform:translateY(-6px); opacity:1; } }

    .chat-messages::-webkit-scrollbar{ width:6px; }
    .chat-messages::-webkit-scrollbar-track{ background:transparent; }
    .chat-messages::-webkit-scrollbar-thumb{ background:rgba(156,163,175,.5); border-radius:3px; }
    .chat-messages::-webkit-scrollbar-thumb:hover{ background:rgba(156,163,175,.7); }

    @media (min-width:768px){
      .chat-container{ max-width:100%; margin:0 auto; }
      .quick-options{ grid-template-columns:1fr 1fr; gap:16px; }
    }
    @media (min-width:1024px){
      .quick-options{ grid-template-columns:1fr 1fr 1fr; }
    }

    @supports (padding-top: env(safe-area-inset-top)){
      .chat-messages{ padding-top:env(safe-area-inset-top); }
      .chat-input-container{ padding-bottom:calc(16px + env(safe-area-inset-bottom)); }
    }
  </style>
</head>
<body>
  <div class="chat-container">
    <div class="chat-messages" id="chatMessages">
      <div class="welcome-section">
        <div class="bot-avatar"><i class="fas fa-home"></i></div>
        <div class="welcome-text">
          <h2>RealE AI 상담사</h2>
          <p>안녕하세요! 부동산 전문 AI입니다. 매매, 전세, 월세 등 부동산 관련 궁금한 것이 있으시면 언제든 말씀해 주세요.</p>
        </div>
        <div class="quick-options">
          <button class="quick-option" onclick="sendQuickMessage('매매 상담을 받고 싶습니다')"><i class="fas fa-home icon"></i><span>매매 상담 받기</span></button>
          <button class="quick-option" onclick="sendQuickMessage('전세 관련해서 알아보고 있습니다')"><i class="fas fa-key icon"></i><span>전세 상담 받기</span></button>
          <button class="quick-option" onclick="sendQuickMessage('월세 상담을 부탁드립니다')"><i class="fas fa-calendar-alt icon"></i><span>월세 상담 받기</span></button>
        </div>
      </div>
    </div>

    <div class="typing-indicator" id="typingIndicator">
      <div class="typing-container">
        <div class="typing-avatar">AI</div>
        <div class="typing-bubble">
          <div class="typing-dots"><span></span><span></span><span></span></div>
        </div>
      </div>
    </div>

    <div class="chat-input-container">
      <div class="chat-input">
        <div class="input-wrapper">
          <textarea id="messageInput" placeholder="어떤 것을 도와드릴까요?" rows="1" maxlength="2000"></textarea>
          <button class="emoji-button" onclick="toggleEmoji()">😊</button>
        </div>
        <button class="send-button" id="sendButton" onclick="sendMessage()">
          <i class="fas fa-arrow-up fa-fw"></i>
        </button>
      </div>
    </div>
  </div>

  <script>
    const messageInput = document.getElementById('messageInput');
    const chatMessages = document.getElementById('chatMessages');
    const sendButton = document.getElementById('sendButton');
    const typingIndicator = document.getElementById('typingIndicator');

    // textarea auto-grow + 버튼 활성/비활성
    messageInput.addEventListener('input', function () {
      this.style.height = 'auto';
      this.style.height = Math.min(this.scrollHeight, 120) + 'px';
      sendButton.disabled = this.value.trim() === '';
    });

    // Enter 전송 (Shift+Enter 줄바꿈)
    messageInput.addEventListener('keydown', function (e) {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    // === 메시지 전송 ===
    async function sendMessage() {
      const message = messageInput.value.trim();
      if (!message) return;

      addMessage(message, 'user');
      messageInput.value = '';
      messageInput.style.height = 'auto';
      sendButton.disabled = true;
      hideWelcomeSection();

      showTyping();
      const reply = await callApi(message);
      hideTyping();
      addMessage(reply, 'assistant');
    }

    async function sendQuickMessage(message) {
      addMessage(message, 'user');
      hideWelcomeSection();

      showTyping();
      const reply = await callApi(message);
      hideTyping();
      addMessage(reply, 'assistant');
    }

    // === 서버 API 호출 (/api/compute) ===
    async function callApi(userMessage) {
      try {
        const res = await fetch('/api/compute', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message: userMessage })
        });
        const data = await res.json();
        return String(data.reply ?? '답변이 없습니다.');
      } catch (e) {
        console.error(e);
        return '서버 오류가 발생했습니다. 잠시 후 다시 시도해 주세요.';
      }
    }

    function addMessage(message, sender) {
      const messagesContainer = chatMessages.querySelector('.messages-container') || createMessagesContainer();
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${sender}`;
      messageDiv.innerHTML = `
        <div class="message-avatar"></div>
        <div class="message-content">${message.replace(/\n/g, '<br>')}</div>
      `;
      messagesContainer.appendChild(messageDiv);
      scrollToBottom();
    }

    function createMessagesContainer() {
      const container = document.createElement('div');
      container.className = 'messages-container';
      chatMessages.appendChild(container);
      return container;
    }

    function showTyping(){ typingIndicator.style.display = 'block'; scrollToBottom(); }
    function hideTyping(){ typingIndicator.style.display = 'none'; }
    function hideWelcomeSection(){
      const welcomeSection = document.querySelector('.welcome-section');
      if (welcomeSection) welcomeSection.style.display = 'none';
    }
    function scrollToBottom(){ setTimeout(() => { chatMessages.scrollTop = chatMessages.scrollHeight; }, 100); }

    function toggleEmoji() {
      const emojis = ['😊','👍','❤️','🤔','💡','🏠','🔑','📊'];
      const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];
      messageInput.value += randomEmoji;
      messageInput.focus();
      sendButton.disabled = messageInput.value.trim() === '';
    }

    // 초기 상태
    sendButton.disabled = true;
    window.addEventListener('resize', scrollToBottom);
  </script>
</body>
</html>
